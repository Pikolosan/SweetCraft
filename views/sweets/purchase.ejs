<% layout('./layouts/boilerplate') -%>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title mb-0">Purchase <%= sweet.name %></h3>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-4">
              <img src="<%= sweet.image.url %>" alt="<%= sweet.name %>" class="img-fluid rounded">
            </div>
            <div class="col-md-8">
              <h4><%= sweet.name %></h4>
              <p class="text-muted"><%= sweet.description %></p>
              <p><strong>Price:</strong> $<%= sweet.price %></p>
              <p><strong>Available Quantity:</strong> <%= sweet.quantityAvailable %></p>
              <p><strong>Weight:</strong> <%= sweet.weight %></p>
            </div>
          </div>

          <form method="POST" action="/sweets/<%= sweet._id %>/purchase" class="needs-validation" novalidate>
            <div class="mb-3">
              <label for="quantity" class="form-label"><strong>Quantity to Purchase</strong></label>
              <input type="number" 
                     name="quantity" 
                     id="quantity" 
                     class="form-control" 
                     min="1" 
                     max="<%= sweet.quantityAvailable %>" 
                     value="1" 
                     required>
              <div class="form-text">Maximum <%= sweet.quantityAvailable %> available</div>
              <div class="invalid-feedback">Please enter a valid quantity between 1 and <%= sweet.quantityAvailable %></div>
            </div>

            <div class="mb-3">
              <p><strong>Total Amount: $<span id="totalAmount"><%= sweet.price %></span></strong></p>
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg">Confirm Purchase</button>
              <a href="/sweets/<%= sweet._id %>" class="btn btn-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Calculate total amount dynamically
  document.getElementById('quantity').addEventListener('input', function() {
    const quantity = this.value;
    const price = <%= sweet.price %>;
    const total = quantity * price;
    document.getElementById('totalAmount').textContent = total.toFixed(2);
  });
</script>